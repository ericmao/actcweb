<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼æ¥­æœƒå“¡ç®¡ç† - ACTC ç®¡ç†å¾Œå°</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-424DY83DBT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-424DY83DBT');
    </script>

    <style>
        .membership-badge {
            @apply px-2 py-1 rounded text-xs font-medium;
        }
        
        .membership-platinum {
            @apply bg-gray-200 text-gray-700;
        }
        
        .membership-gold {
            @apply bg-yellow-200 text-yellow-800;
        }
        
        .membership-silver {
            @apply bg-gray-300 text-gray-700;
        }
        
        .membership-bronze {
            @apply bg-orange-200 text-orange-800;
        }
        
        .membership-regular {
            @apply bg-blue-200 text-blue-800;
        }
        
        .status-active {
            @apply bg-green-100 text-green-800;
        }
        
        .status-inactive {
            @apply bg-red-100 text-red-800;
        }
        
        .display-shown {
            @apply bg-blue-100 text-blue-800;
        }
        
        .display-hidden {
            @apply bg-gray-100 text-gray-800;
        }
        
        .table-container {
            max-height: 70vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50" x-data="corporateMemberApp()">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/admin" class="flex items-center">
                        <img src="/assets/images/actc-logo.jpg" alt="ACTC Logo" class="h-10 w-auto">
                        <span class="ml-3 text-xl font-bold text-gray-900">ACTC ç®¡ç†å¾Œå°</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/admin" class="text-gray-700 hover:text-blue-600 transition-colors">è¿”å›ä¸»æ§å°</a>
                    <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                        ç™»å‡º
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- é é¢æ¨™é¡Œå’Œçµ±è¨ˆ -->
        <div class="mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">ä¼æ¥­æœƒå“¡ç®¡ç†</h1>
                    <p class="text-gray-600 mt-2">ç®¡ç†ä¼æ¥­æœƒå“¡è³‡æ–™ï¼Œæ§åˆ¶å‰ç«¯é¡¯ç¤º</p>
                </div>
                <button @click="showCreateModal = true" 
                        class="mt-4 md:mt-0 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    <svg class="w-5 h-5 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    æ–°å¢ä¼æ¥­æœƒå“¡
                </button>
            </div>

            <!-- çµ±è¨ˆå¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">ç¸½ä¼æ¥­æœƒå“¡</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.total || 0"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">å•Ÿç”¨ä¸­</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.active || 0"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-purple-600 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">å‰ç«¯é¡¯ç¤º</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="stats.displayed || 0"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-yellow-600 rounded-lg flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">é‡‘ç´šä»¥ä¸Š</p>
                            <p class="text-2xl font-semibold text-gray-900" x-text="premiumMembersCount"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¯©é¸å’Œæœå°‹å·¥å…· -->
        <div class="bg-white rounded-lg shadow mb-6 p-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æœå°‹</label>
                    <input type="text" 
                           x-model="searchTerm"
                           @input.debounce.500ms="loadMembers()"
                           placeholder="æœå°‹ä¼æ¥­åç¨±ã€è¯çµ¡äºº..."
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æœƒå“¡é¡å‹</label>
                    <select x-model="membershipFilter" @change="loadMembers()" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">å…¨éƒ¨é¡å‹</option>
                        <option value="platinum">ç™½é‡‘æœƒå“¡</option>
                        <option value="gold">é‡‘ç´šæœƒå“¡</option>
                        <option value="silver">éŠ€ç´šæœƒå“¡</option>
                        <option value="bronze">éŠ…ç´šæœƒå“¡</option>
                        <option value="regular">ä¸€èˆ¬æœƒå“¡</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç‹€æ…‹</label>
                    <select x-model="statusFilter" @change="loadMembers()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                        <option value="active">å•Ÿç”¨</option>
                        <option value="inactive">åœç”¨</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºç‹€æ…‹</label>
                    <select x-model="displayFilter" @change="loadMembers()"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">å…¨éƒ¨</option>
                        <option value="displayed">å‰ç«¯é¡¯ç¤º</option>
                        <option value="hidden">å‰ç«¯éš±è—</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- æ‰¹é‡æ“ä½œå·¥å…· -->
        <div class="bg-white rounded-lg shadow mb-6 p-4" x-show="selectedMembers.length > 0">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-medium text-gray-700">
                        å·²é¸æ“‡ <span x-text="selectedMembers.length"></span> å€‹ä¼æ¥­æœƒå“¡
                    </span>
                    <button @click="selectAll()" class="text-sm text-blue-600 hover:text-blue-800">å…¨é¸</button>
                    <button @click="clearSelection()" class="text-sm text-gray-600 hover:text-gray-800">æ¸…é™¤é¸æ“‡</button>
                </div>
                
                <div class="flex space-x-2">
                    <button @click="batchUpdateDisplay(true)" 
                            class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
                        æ‰¹é‡é¡¯ç¤º
                    </button>
                    <button @click="batchUpdateDisplay(false)" 
                            class="px-3 py-1 bg-gray-600 text-white rounded text-sm hover:bg-gray-700">
                        æ‰¹é‡éš±è—
                    </button>
                    <button @click="batchUpdateStatus(true)" 
                            class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">
                        æ‰¹é‡å•Ÿç”¨
                    </button>
                    <button @click="batchUpdateStatus(false)" 
                            class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">
                        æ‰¹é‡åœç”¨
                    </button>
                </div>
            </div>
        </div>

        <!-- ä¼æ¥­æœƒå“¡åˆ—è¡¨ -->
        <div class="bg-white rounded-lg shadow">
            <div class="table-container">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 text-left">
                                <input type="checkbox" 
                                       @change="toggleSelectAll($event)"
                                       class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ä¼æ¥­è³‡è¨Š
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                æœƒå“¡é¡å‹
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                è²çµ¡è³‡è¨Š
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                ç‹€æ…‹
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                é¡¯ç¤ºé †åº
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                æ“ä½œ
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <template x-for="member in members" :key="member._id">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <input type="checkbox" 
                                           :value="member._id"
                                           x-model="selectedMembers"
                                           class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                </td>
                                
                                <!-- ä¼æ¥­è³‡è¨Š -->
                                <td class="px-6 py-4">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-12 w-12">
                                            <img :src="member.logo || '/assets/images/default-company-logo.png'" 
                                                 :alt="member.companyName"
                                                 class="h-12 w-12 object-contain rounded-lg border">
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900" x-text="member.companyName"></div>
                                            <div class="text-sm text-gray-500" x-text="member.companyNameEn"></div>
                                            <div class="text-xs text-gray-400" x-text="member.industry"></div>
                                        </div>
                                    </div>
                                </td>
                                
                                <!-- æœƒå“¡é¡å‹ -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span :class="'membership-badge membership-' + member.membershipType" 
                                          x-text="getMembershipName(member.membershipType)"></span>
                                    <div class="text-xs text-gray-500 mt-1" x-text="member.membershipLevel"></div>
                                </td>
                                
                                <!-- è¯çµ¡è³‡è¨Š -->
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-900" x-text="member.contactPerson"></div>
                                    <div class="text-sm text-gray-500" x-text="member.email"></div>
                                    <div class="text-xs text-gray-400" x-text="member.phone"></div>
                                </td>
                                
                                <!-- ç‹€æ…‹ -->
                                <td class="px-6 py-4">
                                    <div class="flex flex-col space-y-1">
                                        <span :class="'px-2 py-1 rounded text-xs font-medium ' + (member.isActive ? 'status-active' : 'status-inactive')"
                                              x-text="member.isActive ? 'å•Ÿç”¨' : 'åœç”¨'"></span>
                                        <span :class="'px-2 py-1 rounded text-xs font-medium ' + (member.isDisplayed ? 'display-shown' : 'display-hidden')"
                                              x-text="member.isDisplayed ? 'å‰ç«¯é¡¯ç¤º' : 'å‰ç«¯éš±è—'"></span>
                                    </div>
                                </td>
                                
                                <!-- é¡¯ç¤ºé †åº -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <input type="number" 
                                           :value="member.displayOrder"
                                           @change="updateDisplayOrder(member._id, $event.target.value)"
                                           class="w-16 px-2 py-1 border border-gray-300 rounded text-sm">
                                </td>
                                
                                <!-- æ“ä½œ -->
                                <td class="px-6 py-4 whitespace-nowrap text-sm">
                                    <div class="flex space-x-2">
                                        <button @click="editMember(member)" 
                                                class="text-blue-600 hover:text-blue-900">ç·¨è¼¯</button>
                                        <button @click="toggleDisplay(member._id)" 
                                                class="text-purple-600 hover:text-purple-900"
                                                x-text="member.isDisplayed ? 'éš±è—' : 'é¡¯ç¤º'"></button>
                                        <button @click="toggleStatus(member._id)" 
                                                class="text-green-600 hover:text-green-900"
                                                x-text="member.isActive ? 'åœç”¨' : 'å•Ÿç”¨'"></button>
                                        <button @click="deleteMember(member._id)" 
                                                class="text-red-600 hover:text-red-900">åˆªé™¤</button>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é  -->
            <div class="bg-white px-4 py-3 border-t border-gray-200 sm:px-6">
                <div class="flex items-center justify-between">
                    <div class="flex-1 flex justify-between sm:hidden">
                        <button @click="loadPreviousPage()" 
                                :disabled="pagination.page <= 1"
                                class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                            ä¸Šä¸€é 
                        </button>
                        <button @click="loadNextPage()" 
                                :disabled="pagination.page >= pagination.pages"
                                class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50">
                            ä¸‹ä¸€é 
                        </button>
                    </div>
                    <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                        <div>
                            <p class="text-sm text-gray-700">
                                é¡¯ç¤ºç¬¬ <span x-text="((pagination.page - 1) * pagination.limit) + 1"></span> åˆ° 
                                <span x-text="Math.min(pagination.page * pagination.limit, pagination.total)"></span> ç­†ï¼Œ
                                å…± <span x-text="pagination.total"></span> ç­†è¨˜éŒ„
                            </p>
                        </div>
                        <div>
                            <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
                                <button @click="loadPreviousPage()" 
                                        :disabled="pagination.page <= 1"
                                        class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50">
                                    ä¸Šä¸€é 
                                </button>
                                <button @click="loadNextPage()" 
                                        :disabled="pagination.page >= pagination.pages"
                                        class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50">
                                    ä¸‹ä¸€é 
                                </button>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- å‰µå»º/ç·¨è¼¯ä¼æ¥­æœƒå“¡çš„æ¨¡æ…‹æ¡† -->
    <div x-show="showCreateModal || showEditModal" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="closeModal()"
         class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        
        <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white" @click.stop>
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4" 
                    x-text="showCreateModal ? 'æ–°å¢ä¼æ¥­æœƒå“¡' : 'ç·¨è¼¯ä¼æ¥­æœƒå“¡'"></h3>
                
                <form @submit.prevent="showCreateModal ? createMember() : updateMember()" enctype="multipart/form-data">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- åŸºæœ¬è³‡è¨Š -->
                        <div class="col-span-2">
                            <h4 class="text-md font-medium text-gray-900 mb-3">åŸºæœ¬è³‡è¨Š</h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">å…¬å¸åç¨± *</label>
                            <input type="text" x-model="memberForm.companyName" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">è‹±æ–‡å…¬å¸åç¨±</label>
                            <input type="text" x-model="memberForm.companyNameEn"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">å…¬å¸æè¿°</label>
                            <textarea x-model="memberForm.description" rows="3"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        
                        <!-- æœƒå“¡è³‡è¨Š -->
                        <div class="col-span-2">
                            <h4 class="text-md font-medium text-gray-900 mb-3 mt-6">æœƒå“¡è³‡è¨Š</h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æœƒå“¡é¡å‹</label>
                            <select x-model="memberForm.membershipType" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="regular">ä¸€èˆ¬æœƒå“¡</option>
                                <option value="bronze">éŠ…ç´šæœƒå“¡</option>
                                <option value="silver">éŠ€ç´šæœƒå“¡</option>
                                <option value="gold">é‡‘ç´šæœƒå“¡</option>
                                <option value="platinum">ç™½é‡‘æœƒå“¡</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">æœƒå“¡ç­‰ç´š</label>
                            <select x-model="memberForm.membershipLevel"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="C">C</option>
                                <option value="B">B</option>
                                <option value="B+">B+</option>
                                <option value="A">A</option>
                                <option value="A+">A+</option>
                            </select>
                        </div>
                        
                        <!-- è¯çµ¡è³‡è¨Š -->
                        <div class="col-span-2">
                            <h4 class="text-md font-medium text-gray-900 mb-3 mt-6">è¯çµ¡è³‡è¨Š</h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">è¯çµ¡äºº *</label>
                            <input type="text" x-model="memberForm.contactPerson" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">è·ç¨±</label>
                            <input type="text" x-model="memberForm.contactTitle"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                            <input type="email" x-model="memberForm.email" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é›»è©±</label>
                            <input type="text" x-model="memberForm.phone"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ç¶²ç«™</label>
                            <input type="url" x-model="memberForm.website"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">è¡Œæ¥­</label>
                            <input type="text" x-model="memberForm.industry"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <!-- Logoä¸Šå‚³ -->
                        <div class="col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">å…¬å¸Logo</label>
                            <input type="file" 
                                   @change="handleLogoUpload($event)"
                                   accept="image/*"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div x-show="memberForm.logo" class="mt-2">
                                <img :src="memberForm.logo" alt="Logoé è¦½" class="h-20 w-20 object-contain border rounded">
                            </div>
                        </div>
                        
                        <!-- è¨­å®š -->
                        <div class="col-span-2">
                            <h4 class="text-md font-medium text-gray-900 mb-3 mt-6">è¨­å®š</h4>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºé †åº</label>
                            <input type="number" x-model="memberForm.displayOrder" min="0"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div class="flex items-center space-x-6">
                            <label class="flex items-center">
                                <input type="checkbox" x-model="memberForm.isActive" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">å•Ÿç”¨ç‹€æ…‹</span>
                            </label>
                            
                            <label class="flex items-center">
                                <input type="checkbox" x-model="memberForm.isDisplayed" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                <span class="ml-2 text-sm text-gray-700">å‰ç«¯é¡¯ç¤º</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- æŒ‰éˆ• -->
                    <div class="flex justify-end space-x-4 mt-8">
                        <button type="button" @click="closeModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            å–æ¶ˆ
                        </button>
                        <button type="submit" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <span x-text="showCreateModal ? 'å‰µå»º' : 'æ›´æ–°'"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div x-show="toast.show" 
         x-transition:enter="ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed bottom-4 right-4 max-w-xs bg-white border border-gray-200 rounded-lg shadow-lg z-50">
        <div class="p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <svg x-show="toast.type === 'success'" class="h-5 w-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <svg x-show="toast.type === 'error'" class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </div>
                <div class="ml-3 w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900" x-text="toast.message"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function corporateMemberApp() {
            return {
                // è³‡æ–™ç‹€æ…‹
                members: [],
                stats: {},
                selectedMembers: [],
                
                // åˆ†é ç‹€æ…‹
                pagination: {
                    page: 1,
                    limit: 20,
                    total: 0,
                    pages: 0
                },
                
                // ç¯©é¸ç‹€æ…‹
                searchTerm: '',
                membershipFilter: '',
                statusFilter: '',
                displayFilter: '',
                
                // æ¨¡æ…‹æ¡†ç‹€æ…‹
                showCreateModal: false,
                showEditModal: false,
                editingMember: null,
                
                // è¡¨å–®ç‹€æ…‹
                memberForm: {
                    companyName: '',
                    companyNameEn: '',
                    description: '',
                    contactPerson: '',
                    contactTitle: '',
                    email: '',
                    phone: '',
                    website: '',
                    industry: '',
                    membershipType: 'regular',
                    membershipLevel: 'C',
                    displayOrder: 0,
                    isActive: true,
                    isDisplayed: false,
                    logo: ''
                },
                
                // Toasté€šçŸ¥
                toast: {
                    show: false,
                    type: 'success',
                    message: ''
                },
                
                // åˆå§‹åŒ–
                init() {
                    console.log('ä¼æ¥­æœƒå“¡ç®¡ç†é é¢åˆå§‹åŒ–...');
                    console.log('åˆå§‹æ¨¡æ…‹æ¡†ç‹€æ…‹:', {
                        showCreateModal: this.showCreateModal,
                        showEditModal: this.showEditModal
                    });
                    
                    // ç¢ºä¿æ¨¡æ…‹æ¡†åˆå§‹ç‹€æ…‹ç‚ºé—œé–‰
                    this.showCreateModal = false;
                    this.showEditModal = false;
                    
                    this.loadMembers();
                    this.loadStats();
                },
                
                // è¼‰å…¥ä¼æ¥­æœƒå“¡
                async loadMembers() {
                    try {
                        const token = localStorage.getItem('adminToken');
                        if (!token) {
                            window.location.href = '/admin';
                            return;
                        }
                        
                        const params = new URLSearchParams({
                            page: this.pagination.page,
                            limit: this.pagination.limit
                        });
                        
                        if (this.searchTerm) params.append('search', this.searchTerm);
                        if (this.membershipFilter) params.append('membershipType', this.membershipFilter);
                        if (this.statusFilter) params.append('isActive', this.statusFilter === 'active');
                        if (this.displayFilter) params.append('isDisplayed', this.displayFilter === 'displayed');
                        
                        const response = await fetch(`/api/corporate-members/admin?${params}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.members = data.members;
                            this.pagination = data.pagination;
                            this.stats = data.stats?.[0] || {};
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('è¼‰å…¥ä¼æ¥­æœƒå“¡å¤±æ•—:', error);
                        this.showToast('error', 'è¼‰å…¥ä¼æ¥­æœƒå“¡å¤±æ•—');
                    }
                },
                
                // è¼‰å…¥çµ±è¨ˆ
                async loadStats() {
                    try {
                        const response = await fetch('/api/corporate-members/stats');
                        const data = await response.json();
                        
                        if (data.success) {
                            this.stats = data.stats;
                        }
                    } catch (error) {
                        console.error('è¼‰å…¥çµ±è¨ˆå¤±æ•—:', error);
                    }
                },
                
                // å‰µå»ºä¼æ¥­æœƒå“¡
                async createMember() {
                    try {
                        const token = localStorage.getItem('adminToken');
                        const formData = new FormData();
                        
                        console.log('ğŸ” å‰µå»ºæœƒå“¡è³‡æ–™:', this.memberForm);
                        console.log('ğŸ” æª”æ¡ˆä¸Šå‚³:', this.logoFile);
                        
                        // æ·»åŠ è¡¨å–®æ•¸æ“šï¼ˆæ’é™¤logoï¼Œç¨å¾Œå–®ç¨è™•ç†ï¼‰
                        Object.keys(this.memberForm).forEach(key => {
                            if (key !== 'logo') {
                                formData.append(key, this.memberForm[key]);
                            }
                        });
                        
                        // è™•ç†logoï¼šå„ªå…ˆæª”æ¡ˆä¸Šå‚³ï¼Œå¦å‰‡ä½¿ç”¨URL
                        if (this.logoFile) {
                            console.log('ğŸ” ä½¿ç”¨æª”æ¡ˆä¸Šå‚³');
                            formData.append('logo', this.logoFile);
                        } else if (this.memberForm.logo && typeof this.memberForm.logo === 'string') {
                            console.log('ğŸ” ä½¿ç”¨åœ–ç‰‡URL:', this.memberForm.logo);
                            formData.append('logo', this.memberForm.logo);
                        }
                        
                        const response = await fetch('/api/corporate-members/admin', {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            },
                            body: formData
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', 'ä¼æ¥­æœƒå“¡å‰µå»ºæˆåŠŸ');
                            this.closeModal();
                            this.loadMembers();
                            this.loadStats();
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('å‰µå»ºä¼æ¥­æœƒå“¡å¤±æ•—:', error);
                        this.showToast('error', 'å‰µå»ºä¼æ¥­æœƒå“¡å¤±æ•—');
                    }
                },
                
                // ç·¨è¼¯ä¼æ¥­æœƒå“¡
                editMember(member) {
                    this.editingMember = member;
                    // åªè¤‡è£½å¯ç·¨è¼¯çš„æ¬„ä½ï¼Œé¿å…ç³»çµ±æ¬„ä½å’Œè™›æ“¬æ¬„ä½
                    this.memberForm = {
                        companyName: member.companyName || '',
                        companyNameEn: member.companyNameEn || '',
                        description: member.description || '',
                        contactPerson: member.contactPerson || '',
                        contactTitle: member.contactTitle || '',
                        email: member.email || '',
                        phone: member.phone || '',
                        website: member.website || '',
                        country: member.country || '',
                        industry: member.industry || '',
                        membershipType: member.membershipType || 'regular',
                        membershipLevel: member.membershipLevel || 'C',
                        services: member.services || [],
                        specialization: member.specialization || [],
                        tags: member.tags || [],
                        displayOrder: member.displayOrder || 0,
                        isActive: member.isActive !== undefined ? member.isActive : true,
                        isDisplayed: member.isDisplayed !== undefined ? member.isDisplayed : false,
                        logo: member.logo || ''
                    };
                    this.showEditModal = true;
                },
                
                // æ›´æ–°ä¼æ¥­æœƒå“¡
                async updateMember() {
                    try {
                        const token = localStorage.getItem('adminToken');
                        const formData = new FormData();
                        
                        console.log('ğŸ” æ›´æ–°æœƒå“¡è³‡æ–™:', this.memberForm);
                        console.log('ğŸ” æª”æ¡ˆä¸Šå‚³:', this.logoFile);
                        
                        // æ·»åŠ è¡¨å–®æ•¸æ“šï¼ˆæ’é™¤logoï¼Œç¨å¾Œå–®ç¨è™•ç†ï¼‰
                        Object.keys(this.memberForm).forEach(key => {
                            if (key !== 'logo') {
                                formData.append(key, this.memberForm[key]);
                            }
                        });
                        
                        // è™•ç†logoï¼šå„ªå…ˆæª”æ¡ˆä¸Šå‚³ï¼Œå¦å‰‡ä½¿ç”¨URL
                        if (this.logoFile) {
                            console.log('ğŸ” ä½¿ç”¨æª”æ¡ˆä¸Šå‚³');
                            formData.append('logo', this.logoFile);
                        } else if (this.memberForm.logo && typeof this.memberForm.logo === 'string') {
                            console.log('ğŸ” ä½¿ç”¨åœ–ç‰‡URL:', this.memberForm.logo);
                            formData.append('logo', this.memberForm.logo);
                        }
                        
                        const response = await fetch(`/api/corporate-members/admin/${this.editingMember._id}`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            },
                            body: formData
                        });
                        
                        console.log('ğŸ” HTTPç‹€æ…‹:', response.status);
                        
                        const data = await response.json();
                        console.log('ğŸ” ä¼ºæœå™¨éŸ¿æ‡‰:', data);
                        
                        if (data.success) {
                            this.showToast('success', 'ä¼æ¥­æœƒå“¡æ›´æ–°æˆåŠŸ');
                            this.closeModal();
                            this.loadMembers();
                        } else {
                            console.error('âŒ æ›´æ–°å¤±æ•—:', data);
                            this.showToast('error', data.message || 'æ›´æ–°å¤±æ•—');
                        }
                    } catch (error) {
                        console.error('âŒ æ›´æ–°ä¼æ¥­æœƒå“¡å¤±æ•—:', error);
                        this.showToast('error', 'æ›´æ–°ä¼æ¥­æœƒå“¡å¤±æ•—: ' + error.message);
                    }
                },
                
                // åˆ‡æ›é¡¯ç¤ºç‹€æ…‹
                async toggleDisplay(memberId) {
                    try {
                        const token = localStorage.getItem('adminToken');
                        
                        const response = await fetch(`/api/corporate-members/admin/${memberId}/toggle-display`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', data.message);
                            this.loadMembers();
                            this.loadStats();
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('åˆ‡æ›é¡¯ç¤ºç‹€æ…‹å¤±æ•—:', error);
                        this.showToast('error', 'åˆ‡æ›é¡¯ç¤ºç‹€æ…‹å¤±æ•—');
                    }
                },
                
                // åˆ‡æ›å•Ÿç”¨ç‹€æ…‹
                async toggleStatus(memberId) {
                    try {
                        const token = localStorage.getItem('adminToken');
                        
                        const response = await fetch(`/api/corporate-members/admin/${memberId}/toggle-active`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', data.message);
                            this.loadMembers();
                            this.loadStats();
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('åˆ‡æ›å•Ÿç”¨ç‹€æ…‹å¤±æ•—:', error);
                        this.showToast('error', 'åˆ‡æ›å•Ÿç”¨ç‹€æ…‹å¤±æ•—');
                    }
                },
                
                // æ›´æ–°é¡¯ç¤ºé †åº
                async updateDisplayOrder(memberId, order) {
                    try {
                        const token = localStorage.getItem('adminToken');
                        
                        const response = await fetch(`/api/corporate-members/admin/${memberId}/display-order`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ displayOrder: parseInt(order) })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', 'é¡¯ç¤ºé †åºæ›´æ–°æˆåŠŸ');
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('æ›´æ–°é¡¯ç¤ºé †åºå¤±æ•—:', error);
                        this.showToast('error', 'æ›´æ–°é¡¯ç¤ºé †åºå¤±æ•—');
                    }
                },
                
                // åˆªé™¤ä¼æ¥­æœƒå“¡
                async deleteMember(memberId) {
                    if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ä¼æ¥­æœƒå“¡å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                        return;
                    }
                    
                    try {
                        const token = localStorage.getItem('adminToken');
                        
                        const response = await fetch(`/api/corporate-members/admin/${memberId}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', 'ä¼æ¥­æœƒå“¡åˆªé™¤æˆåŠŸ');
                            this.loadMembers();
                            this.loadStats();
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('åˆªé™¤ä¼æ¥­æœƒå“¡å¤±æ•—:', error);
                        this.showToast('error', 'åˆªé™¤ä¼æ¥­æœƒå“¡å¤±æ•—');
                    }
                },
                
                // è™•ç†logoä¸Šå‚³
                handleLogoUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.logoFile = file;
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.memberForm.logo = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },
                
                // æ‰¹é‡æ“ä½œ
                async batchUpdateDisplay(isDisplayed) {
                    if (this.selectedMembers.length === 0) return;
                    
                    try {
                        const token = localStorage.getItem('adminToken');
                        
                        const response = await fetch('/api/corporate-members/admin/batch', {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                ids: this.selectedMembers,
                                action: 'toggleDisplay',
                                value: isDisplayed
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', data.message);
                            this.clearSelection();
                            this.loadMembers();
                            this.loadStats();
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('æ‰¹é‡æ“ä½œå¤±æ•—:', error);
                        this.showToast('error', 'æ‰¹é‡æ“ä½œå¤±æ•—');
                    }
                },
                
                async batchUpdateStatus(isActive) {
                    if (this.selectedMembers.length === 0) return;
                    
                    try {
                        const token = localStorage.getItem('adminToken');
                        
                        const response = await fetch('/api/corporate-members/admin/batch', {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${token}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                ids: this.selectedMembers,
                                action: 'toggleActive',
                                value: isActive
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.showToast('success', data.message);
                            this.clearSelection();
                            this.loadMembers();
                            this.loadStats();
                        } else {
                            this.showToast('error', data.message);
                        }
                    } catch (error) {
                        console.error('æ‰¹é‡æ“ä½œå¤±æ•—:', error);
                        this.showToast('error', 'æ‰¹é‡æ“ä½œå¤±æ•—');
                    }
                },
                
                // é¸æ“‡æ“ä½œ
                toggleSelectAll(event) {
                    if (event.target.checked) {
                        this.selectedMembers = this.members.map(m => m._id);
                    } else {
                        this.selectedMembers = [];
                    }
                },
                
                selectAll() {
                    this.selectedMembers = this.members.map(m => m._id);
                },
                
                clearSelection() {
                    this.selectedMembers = [];
                },
                
                // åˆ†é æ“ä½œ
                loadPreviousPage() {
                    if (this.pagination.page > 1) {
                        this.pagination.page--;
                        this.loadMembers();
                    }
                },
                
                loadNextPage() {
                    if (this.pagination.page < this.pagination.pages) {
                        this.pagination.page++;
                        this.loadMembers();
                    }
                },
                
                // é—œé–‰æ¨¡æ…‹æ¡†
                closeModal() {
                    console.log('é—œé–‰æ¨¡æ…‹æ¡†');
                    this.showCreateModal = false;
                    this.showEditModal = false;
                    this.editingMember = null;
                    this.logoFile = null;
                    this.memberForm = {
                        companyName: '',
                        companyNameEn: '',
                        description: '',
                        contactPerson: '',
                        contactTitle: '',
                        email: '',
                        phone: '',
                        website: '',
                        industry: '',
                        membershipType: 'regular',
                        membershipLevel: 'C',
                        displayOrder: 0,
                        isActive: true,
                        isDisplayed: false,
                        logo: ''
                    };
                },
                
                // é¡¯ç¤ºToast
                showToast(type, message) {
                    this.toast = { show: true, type, message };
                    setTimeout(() => {
                        this.toast.show = false;
                    }, 3000);
                },
                
                // å–å¾—æœƒå“¡é¡å‹åç¨±
                getMembershipName(type) {
                    const names = {
                        'platinum': 'ç™½é‡‘æœƒå“¡',
                        'gold': 'é‡‘ç´šæœƒå“¡',
                        'silver': 'éŠ€ç´šæœƒå“¡',
                        'bronze': 'éŠ…ç´šæœƒå“¡',
                        'regular': 'ä¸€èˆ¬æœƒå“¡'
                    };
                    return names[type] || 'æœƒå“¡';
                },
                
                // è¨ˆç®—é‡‘ç´šä»¥ä¸Šæœƒå“¡æ•¸
                get premiumMembersCount() {
                    if (!this.stats.membershipTypes) return 0;
                    return this.stats.membershipTypes
                        .filter(m => ['platinum', 'gold'].includes(m._id))
                        .reduce((sum, m) => sum + m.count, 0);
                }
            }
        }
        
        // ç™»å‡ºåŠŸèƒ½
        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = '/admin';
        }
    </script>
</body>
</html>
