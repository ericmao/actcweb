<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å¾Œå° - ACTC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="/components/NewsManagement.js"></script>
</head>
<body class="bg-gray-50" x-data="adminApp()">
    <!-- å¼·åˆ¶ä¿®æ”¹å¯†ç¢¼å°è©±æ¡† -->
    <div x-show="showForcePasswordChange" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg max-w-md w-full mx-4">
            <h3 class="text-lg font-semibold mb-4">é¦–æ¬¡ç™»å…¥ - è«‹ä¿®æ”¹å¯†ç¢¼</h3>
            <form @submit.prevent="forceChangePassword">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">æ–°å¯†ç¢¼</label>
                    <input type="password" x-model="newPassword" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">ç¢ºèªæ–°å¯†ç¢¼</label>
                    <input type="password" x-model="confirmPassword" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="flex space-x-2">
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                        ç¢ºèªä¿®æ”¹
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç™»å…¥è¡¨å–® -->
    <div x-show="!isLoggedIn && !showForcePasswordChange" class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full space-y-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">ç®¡ç†å“¡ç™»å…¥</h2>
            </div>
            <form @submit.prevent="login" class="mt-8 space-y-6">
                <div>
                    <input x-model="loginForm.username" type="text" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                           placeholder="ä½¿ç”¨è€…å¸³è™Ÿ">
                </div>
                <div>
                    <input x-model="loginForm.password" type="password" required 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                           placeholder="å¯†ç¢¼">
                </div>
                <div>
                    <button type="submit" :disabled="isLoading"
                            class="w-full bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 disabled:opacity-50">
                        <span x-show="!isLoading">ç™»å…¥</span>
                        <span x-show="isLoading">ç™»å…¥ä¸­...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ç®¡ç†å¾Œå° -->
    <div x-show="isLoggedIn && !showForcePasswordChange">
        <!-- å°èˆªåˆ— -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center h-16">
                    <h1 class="text-xl font-bold">ACTC ç®¡ç†å¾Œå°</h1>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-600" x-text="`æ­¡è¿, ${currentUser.username} (${currentUser.role})`"></span>
                        <button @click="logout" class="bg-red-500 text-white px-4 py-2 rounded text-sm">ç™»å‡º</button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- å´é‚Šé¸å–® -->
        <div class="flex">
            <aside class="w-64 bg-gray-800 min-h-screen">
                <nav class="mt-8">
                    <template x-if="currentUser.role === 'admin'">
                        <a @click="currentTab = 'users'" 
                           :class="currentTab === 'users' ? 'bg-gray-700 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'"
                           class="flex items-center px-6 py-3 cursor-pointer">
                            <span>ä½¿ç”¨è€…ç®¡ç†</span>
                        </a>
                    </template>
                    <a @click="currentTab = 'news'" 
                       :class="currentTab === 'news' ? 'bg-gray-700 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'"
                       class="flex items-center px-6 py-3 cursor-pointer">
                        <span>æœ€æ–°æ¶ˆæ¯ç®¡ç†</span>
                    </a>
                    <a @click="currentTab = 'events'" 
                       :class="currentTab === 'events' ? 'bg-gray-700 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'"
                       class="flex items-center px-6 py-3 cursor-pointer">
                        <span>æ´»å‹•èª²ç¨‹ç®¡ç†</span>
                    </a>
                    <a @click="currentTab = 'corporate-members'" 
                       :class="currentTab === 'corporate-members' ? 'bg-gray-700 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'"
                       class="flex items-center px-6 py-3 cursor-pointer">
                        <span>ä¼æ¥­æœƒå“¡ç®¡ç†</span>
                    </a>
                </nav>
            </aside>

            <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
            <main class="flex-1 p-8">
                <!-- ä½¿ç”¨è€…ç®¡ç† -->
                <div x-show="currentTab === 'users'" x-data="usersTab()">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">ä½¿ç”¨è€…ç®¡ç†</h2>
                        <button @click="showCreateModal = true" class="bg-blue-600 text-white px-4 py-2 rounded">
                            æ–°å¢ä½¿ç”¨è€…
                        </button>
                    </div>

                    <!-- ä½¿ç”¨è€…åˆ—è¡¨ -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <table class="min-w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ä½¿ç”¨è€…åç¨±</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">é›»å­éƒµä»¶</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">è§’è‰²</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ç‹€æ…‹</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æœ€å¾Œç™»å…¥</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <template x-for="user in users" :key="user._id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900" x-text="user.username"></div>
                                            <div class="text-sm text-gray-500" x-text="user.fullName || '-'"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="user.email || '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'"
                                                  class="px-2 py-1 text-xs font-semibold rounded-full" x-text="user.role"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="user.isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                  class="px-2 py-1 text-xs font-semibold rounded-full" x-text="user.isActive ? 'å•Ÿç”¨' : 'åœç”¨'"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" 
                                            x-text="user.lastLogin ? new Date(user.lastLogin).toLocaleString() : '-'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                            <button @click="editUser(user)" class="text-blue-600 hover:text-blue-900">ç·¨è¼¯</button>
                                            <button @click="toggleUserStatus(user)" 
                                                    :class="user.isActive ? 'text-red-600 hover:text-red-900' : 'text-green-600 hover:text-green-900'"
                                                    x-text="user.isActive ? 'åœç”¨' : 'å•Ÿç”¨'"></button>
                                            <button @click="resetPassword(user)" class="text-yellow-600 hover:text-yellow-900">é‡è¨­å¯†ç¢¼</button>
                                            <button @click="deleteUser(user)" class="text-red-600 hover:text-red-900">åˆªé™¤</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <!-- æ–°å¢/ç·¨è¼¯ä½¿ç”¨è€… Modal -->
                    <div x-show="showCreateModal || showEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div class="bg-white p-6 rounded-lg max-w-md w-full mx-4">
                            <h3 class="text-lg font-semibold mb-4" x-text="showEditModal ? 'ç·¨è¼¯ä½¿ç”¨è€…' : 'æ–°å¢ä½¿ç”¨è€…'"></h3>
                            <form @submit.prevent="showEditModal ? updateUser() : createUser()">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">ä½¿ç”¨è€…åç¨±</label>
                                    <input type="text" x-model="userForm.username" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">é›»å­éƒµä»¶</label>
                                    <input type="email" x-model="userForm.email" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">å…¨å</label>
                                    <input type="text" x-model="userForm.fullName" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">è§’è‰²</label>
                                    <select x-model="userForm.role" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                                        <option value="user">ä¸€èˆ¬ä½¿ç”¨è€…</option>
                                        <option value="admin">ç®¡ç†å“¡</option>
                                    </select>
                                </div>
                                <div class="flex space-x-2">
                                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                                        <span x-text="showEditModal ? 'æ›´æ–°' : 'å‰µå»º'"></span>
                                    </button>
                                    <button type="button" @click="closeModal" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400">
                                        å–æ¶ˆ
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- æœ€æ–°æ¶ˆæ¯ç®¡ç† -->
                <div x-show="currentTab === 'news'">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="text-center">
                            <h2 class="text-3xl font-bold text-gray-900 mb-4">æœ€æ–°æ¶ˆæ¯ç®¡ç†</h2>
                            <p class="text-gray-600 mb-8">ç®¡ç†ç¶²ç«™çš„æœ€æ–°æ¶ˆæ¯ã€æ–‡ç« å’Œå…¬å‘Š</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <!-- çµ±è¨ˆå¡ç‰‡ -->
                                <div class="bg-blue-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-blue-600 mb-2" id="newsStatsPublished">-</div>
                                    <div class="text-sm text-gray-600">å·²ç™¼å¸ƒæ–°è</div>
                                </div>
                                <div class="bg-yellow-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-yellow-600 mb-2" id="newsStatsDraft">-</div>
                                    <div class="text-sm text-gray-600">è‰ç¨¿æ–°è</div>
                                </div>
                                <div class="bg-green-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-green-600 mb-2" id="newsStatsViews">-</div>
                                    <div class="text-sm text-gray-600">ç¸½ç€è¦½æ¬¡æ•¸</div>
                                </div>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <a href="/admin/news" 
                                   class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    é€²å…¥æ–°èç®¡ç†
                                </a>
                                
                                <button onclick="loadNewsQuickStats()" 
                                        class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    é‡æ–°è¼‰å…¥çµ±è¨ˆ
                                </button>
                            </div>
                            
                            <div class="mt-8 text-left">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">åŠŸèƒ½èªªæ˜</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-medium text-gray-900 mb-2">ğŸ“ å…§å®¹ç®¡ç†</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li>â€¢ å‰µå»ºå’Œç·¨è¼¯æ–°èæ–‡ç« </li>
                                            <li>â€¢ ä¸Šå‚³åœ–ç‰‡å’Œé™„ä»¶æª”æ¡ˆ</li>
                                            <li>â€¢ åµŒå…¥ YouTube/Instagram å½±ç‰‡</li>
                                            <li>â€¢ è¨­å®šç™¼å¸ƒæ™‚é–“å’Œç‹€æ…‹</li>
                                        </ul>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-medium text-gray-900 mb-2">ğŸ“Š æ•¸æ“šè¿½è¹¤</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li>â€¢ Google Analytics æ•´åˆ</li>
                                            <li>â€¢ ç€è¦½æ¬¡æ•¸çµ±è¨ˆ</li>
                                            <li>â€¢ ç”¨æˆ¶äº’å‹•åˆ†æ</li>
                                            <li>â€¢ ç†±é–€æ–‡ç« è¿½è¹¤</li>
                                        </ul>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-medium text-gray-900 mb-2">ğŸ”§ æ‰¹é‡æ“ä½œ</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li>â€¢ æ‰¹é‡ç™¼å¸ƒ/è¨­ç‚ºè‰ç¨¿</li>
                                            <li>â€¢ æ‰¹é‡åˆªé™¤æ–‡ç« </li>
                                            <li>â€¢ æ¨™ç±¤ç®¡ç†</li>
                                            <li>â€¢ ç²¾é¸æ–‡ç« è¨­å®š</li>
                                        </ul>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-medium text-gray-900 mb-2">ğŸ” æœå°‹ç¯©é¸</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li>â€¢ æ¨™é¡Œ/å…§å®¹æœå°‹</li>
                                            <li>â€¢ ç‹€æ…‹ç¯©é¸</li>
                                            <li>â€¢ æ—¥æœŸç¯„åœç¯©é¸</li>
                                            <li>â€¢ æ’åºåŠŸèƒ½</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ´»å‹•èª²ç¨‹ç®¡ç† -->
                <div x-show="currentTab === 'events'">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="text-center">
                            <h2 class="text-3xl font-bold text-gray-900 mb-4">æ´»å‹•èª²ç¨‹ç®¡ç†</h2>
                            <p class="text-gray-600 mb-8">ç®¡ç†æ´»å‹•èª²ç¨‹ï¼Œæ”¯æ´æª”æ¡ˆä¸Šå‚³ã€åœ–ç‰‡ç®¡ç†å’Œè¬›å¸«ä»‹ç´¹</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <!-- çµ±è¨ˆå¡ç‰‡ -->
                                <div class="bg-blue-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-blue-600 mb-2" id="eventStatsTotal">-</div>
                                    <div class="text-sm text-gray-600">ç¸½æ´»å‹•æ•¸</div>
                                </div>
                                <div class="bg-green-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-green-600 mb-2" id="eventStatsUpcoming">-</div>
                                    <div class="text-sm text-gray-600">å³å°‡åˆ°ä¾†</div>
                                </div>
                                <div class="bg-purple-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-purple-600 mb-2" id="eventStatsWithFiles">-</div>
                                    <div class="text-sm text-gray-600">æœ‰æª”æ¡ˆ</div>
                                </div>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <a href="/admin-events.html" 
                                   class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                    </svg>
                                    é€²å…¥æ´»å‹•èª²ç¨‹ç®¡ç†
                                </a>

                                <button onclick="loadEventQuickStats()"
                                        class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    é‡æ–°è¼‰å…¥çµ±è¨ˆ
                                </button>
                            </div>
                            
                            <!-- åŠŸèƒ½èªªæ˜ -->
                            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">âœ¨ ä¸»è¦åŠŸèƒ½</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>â€¢ æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤æ´»å‹•èª²ç¨‹</li>
                                        <li>â€¢ æ´»å‹•åœ–ç‰‡ä¸Šå‚³å’Œç®¡ç†</li>
                                        <li>â€¢ æª”æ¡ˆä¸Šå‚³ï¼ˆ20MBä»¥ä¸‹ï¼‰</li>
                                        <li>â€¢ è¬›å¸«ä»‹ç´¹å’Œç…§ç‰‡</li>
                                        <li>â€¢ æ´»å‹•ç‹€æ…‹ç®¡ç†</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">ğŸ›ï¸ é€²éšåŠŸèƒ½</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>â€¢ æ´»å‹•é¡å‹åˆ†é¡</li>
                                        <li>â€¢ å ±ååé¡ç®¡ç†</li>
                                        <li>â€¢ æ™‚é–“å’Œåœ°é»è¨­å®š</li>
                                        <li>â€¢ æ¨™ç±¤å’Œéœ€æ±‚ç®¡ç†</li>
                                        <li>â€¢ çµ±è¨ˆå’Œå ±è¡¨</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ä¼æ¥­æœƒå“¡ç®¡ç† -->
                <div x-show="currentTab === 'corporate-members'">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="text-center">
                            <h2 class="text-3xl font-bold text-gray-900 mb-4">ä¼æ¥­æœƒå“¡ç®¡ç†</h2>
                            <p class="text-gray-600 mb-8">ç®¡ç†ä¼æ¥­æœƒå“¡è³‡æ–™ï¼Œæ§åˆ¶å‰ç«¯é¡¯ç¤º</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <!-- çµ±è¨ˆå¡ç‰‡ -->
                                <div class="bg-purple-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-purple-600 mb-2" id="memberStatsTotal">-</div>
                                    <div class="text-sm text-gray-600">ç¸½ä¼æ¥­æœƒå“¡</div>
                                </div>
                                <div class="bg-green-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-green-600 mb-2" id="memberStatsActive">-</div>
                                    <div class="text-sm text-gray-600">å•Ÿç”¨æœƒå“¡</div>
                                </div>
                                <div class="bg-blue-50 p-6 rounded-lg">
                                    <div class="text-3xl font-bold text-blue-600 mb-2" id="memberStatsDisplayed">-</div>
                                    <div class="text-sm text-gray-600">å‰ç«¯é¡¯ç¤º</div>
                                </div>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                                <a href="/admin/corporate-members" 
                                   class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                    é€²å…¥ä¼æ¥­æœƒå“¡ç®¡ç†
                                </a>

                                <button onclick="loadMemberQuickStats()"
                                        class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 text-base font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    é‡æ–°è¼‰å…¥çµ±è¨ˆ
                                </button>
                            </div>
                            
                            <!-- åŠŸèƒ½èªªæ˜ -->
                            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">âœ¨ ä¸»è¦åŠŸèƒ½</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>â€¢ æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ä¼æ¥­æœƒå“¡</li>
                                        <li>â€¢ æœƒå“¡é¡å‹ç®¡ç†ï¼ˆç™½é‡‘ã€é‡‘ç´šã€éŠ€ç´šã€éŠ…ç´šï¼‰</li>
                                        <li>â€¢ å…¬å¸Logoä¸Šå‚³</li>
                                        <li>â€¢ è¯çµ¡è³‡è¨Šç®¡ç†</li>
                                        <li>â€¢ é¡¯ç¤ºé †åºæ§åˆ¶</li>
                                    </ul>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">ğŸ›ï¸ é¡¯ç¤ºæ§åˆ¶</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>â€¢ å•Ÿç”¨/åœç”¨ä¼æ¥­æœƒå“¡</li>
                                        <li>â€¢ å‰ç«¯é¡¯ç¤º/éš±è—æ§åˆ¶</li>
                                        <li>â€¢ æ‰¹é‡æ“ä½œåŠŸèƒ½</li>
                                        <li>â€¢ æœƒå“¡é¡å‹ç¯©é¸</li>
                                        <li>â€¢ æœå°‹å’Œæ’åº</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        function adminApp() {
            return {
                isLoggedIn: false,
                isLoading: false,
                currentUser: null,
                currentTab: 'users',
                showForcePasswordChange: false,
                newPassword: '',
                confirmPassword: '',
                loginForm: {
                    username: '',
                    password: ''
                },

                async init() {
                    await this.checkAuth();
                },

                async checkAuth() {
                    const token = localStorage.getItem('adminToken');
                    if (!token) return;

                    try {
                        const response = await fetch('/api/auth/verify', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.currentUser = data.user;
                            this.isLoggedIn = true;
                            
                            if (data.user.isFirstLogin) {
                                this.showForcePasswordChange = true;
                            }
                        } else {
                            localStorage.removeItem('adminToken');
                        }
                    } catch (error) {
                        console.error('Auth check failed:', error);
                        localStorage.removeItem('adminToken');
                    }
                },

                async login() {
                    this.isLoading = true;
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                            body: JSON.stringify(this.loginForm)
                });

                        const data = await response.json();

                if (response.ok) {
                            localStorage.setItem('adminToken', data.token);
                            this.currentUser = data.user;
                            this.isLoggedIn = true;
                            
                            if (data.user.isFirstLogin) {
                                this.showForcePasswordChange = true;
                            }
                            
                            this.loginForm = { username: '', password: '' };
                } else {
                            alert('ç™»å…¥å¤±æ•—ï¼š' + data.message);
                }
            } catch (error) {
                alert('ç™»å…¥éŒ¯èª¤ï¼š' + error.message);
                    } finally {
                        this.isLoading = false;
                    }
                },

                async forceChangePassword() {
                    if (this.newPassword !== this.confirmPassword) {
                        alert('å¯†ç¢¼ç¢ºèªä¸ç¬¦');
                        return;
                    }

                    try {
                        const response = await fetch('/api/auth/force-change-password', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            },
                            body: JSON.stringify({
                                newPassword: this.newPassword
                            })
                        });

                        if (response.ok) {
                            this.showForcePasswordChange = false;
                            this.currentUser.isFirstLogin = false;
                            this.newPassword = '';
                            this.confirmPassword = '';
                            alert('å¯†ç¢¼ä¿®æ”¹æˆåŠŸï¼');
                        } else {
                            const data = await response.json();
                            alert('å¯†ç¢¼ä¿®æ”¹å¤±æ•—ï¼š' + data.message);
                        }
                    } catch (error) {
                        alert('å¯†ç¢¼ä¿®æ”¹éŒ¯èª¤ï¼š' + error.message);
                    }
                },

                logout() {
                    localStorage.removeItem('adminToken');
                    this.isLoggedIn = false;
                    this.currentUser = null;
                    this.currentTab = 'users';
                }
            }
        }

        function usersTab() {
            return {
                users: [],
                showCreateModal: false,
                showEditModal: false,
                editingUser: null,
                userForm: {
                    username: '',
                    email: '',
                    fullName: '',
                    role: 'user'
                },

                async init() {
                    await this.loadUsers();
                },

                async loadUsers() {
                    try {
                        const response = await fetch('/api/users', {
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.users = data.users;
                        }
                    } catch (error) {
                        console.error('Load users failed:', error);
                    }
                },

                async createUser() {
                    try {
                        const response = await fetch('/api/users', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            },
                            body: JSON.stringify(this.userForm)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            await this.loadUsers();
                            this.closeModal();
                            alert('ä½¿ç”¨è€…å‰µå»ºæˆåŠŸï¼é è¨­å¯†ç¢¼ç‚º "user"');
                        } else {
                            alert('å‰µå»ºå¤±æ•—ï¼š' + data.message);
                        }
                    } catch (error) {
                        alert('å‰µå»ºéŒ¯èª¤ï¼š' + error.message);
                    }
                },

                editUser(user) {
                    this.editingUser = user;
                    this.userForm = {
                        username: user.username,
                        email: user.email || '',
                        fullName: user.fullName || '',
                        role: user.role
                    };
                    this.showEditModal = true;
                },

                async updateUser() {
                    try {
                        const response = await fetch(`/api/users/${this.editingUser._id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            },
                            body: JSON.stringify(this.userForm)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            await this.loadUsers();
                            this.closeModal();
                            alert('ä½¿ç”¨è€…æ›´æ–°æˆåŠŸï¼');
            } else {
                            alert('æ›´æ–°å¤±æ•—ï¼š' + data.message);
                        }
                    } catch (error) {
                        alert('æ›´æ–°éŒ¯èª¤ï¼š' + error.message);
                    }
                },

                async toggleUserStatus(user) {
                    if (!confirm(`ç¢ºå®šè¦${user.isActive ? 'åœç”¨' : 'å•Ÿç”¨'}æ­¤ä½¿ç”¨è€…å—ï¼Ÿ`)) return;

                    try {
                        const response = await fetch(`/api/users/${user._id}/toggle-status`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            }
                        });

                        if (response.ok) {
                            await this.loadUsers();
                        }
                    } catch (error) {
                        alert('æ“ä½œå¤±æ•—ï¼š' + error.message);
                    }
                },

                async resetPassword(user) {
                    if (!confirm('ç¢ºå®šè¦é‡è¨­æ­¤ä½¿ç”¨è€…çš„å¯†ç¢¼å—ï¼Ÿå¯†ç¢¼å°‡é‡è¨­ç‚º "user"')) return;

                    try {
                        const response = await fetch(`/api/users/${user._id}/reset-password`, {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            }
                        });

                        if (response.ok) {
                            alert('å¯†ç¢¼é‡è¨­æˆåŠŸï¼æ–°å¯†ç¢¼ç‚º "user"');
                        }
                    } catch (error) {
                        alert('å¯†ç¢¼é‡è¨­å¤±æ•—ï¼š' + error.message);
                    }
                },

                async deleteUser(user) {
                    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ä½¿ç”¨è€… "${user.username}" å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) return;

                    try {
                        const response = await fetch(`/api/users/${user._id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                            }
                        });

                        if (response.ok) {
                            await this.loadUsers();
                            alert('ä½¿ç”¨è€…åˆªé™¤æˆåŠŸï¼');
                        }
                    } catch (error) {
                        alert('åˆªé™¤å¤±æ•—ï¼š' + error.message);
                    }
                },

                closeModal() {
                    this.showCreateModal = false;
                    this.showEditModal = false;
                    this.editingUser = null;
                    this.userForm = {
                        username: '',
                        email: '',
                        fullName: '',
                        role: 'user'
                    };
                }
            }
        }
        // è¼‰å…¥æ–°èå¿«é€Ÿçµ±è¨ˆ
        async function loadNewsQuickStats() {
            try {
                const token = localStorage.getItem('adminToken');
                if (!token) return;

                const response = await fetch('/api/news/admin?limit=1', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const stats = data.stats || {};
                    
                    document.getElementById('newsStatsPublished').textContent = stats.published?.count || 0;
                    document.getElementById('newsStatsDraft').textContent = stats.draft?.count || 0;
                    document.getElementById('newsStatsViews').textContent = (stats.published?.totalViews || 0) + (stats.draft?.totalViews || 0);
                } else {
                    console.error('Failed to load news stats');
                }
            } catch (error) {
                console.error('Error loading news stats:', error);
            }
        }

        // è¼‰å…¥ä¼æ¥­æœƒå“¡å¿«é€Ÿçµ±è¨ˆ
        async function loadMemberQuickStats() {
            try {
                const token = localStorage.getItem('adminToken');
                if (!token) return;

                const response = await fetch('/api/corporate-members/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const stats = data.stats || {};
                    
                    document.getElementById('memberStatsTotal').textContent = stats.total || 0;
                    document.getElementById('memberStatsActive').textContent = stats.active || 0;
                    document.getElementById('memberStatsDisplayed').textContent = stats.displayed || 0;
                } else {
                    console.error('Failed to load member stats');
                }
            } catch (error) {
                console.error('Error loading member stats:', error);
            }
        }

        // è¼‰å…¥æ´»å‹•èª²ç¨‹å¿«é€Ÿçµ±è¨ˆ
        async function loadEventQuickStats() {
            try {
                const token = localStorage.getItem('adminToken');
                if (!token) return;

                const response = await fetch('/api/events/stats', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    document.getElementById('eventStatsTotal').textContent = data.totalEvents || 0;
                    document.getElementById('eventStatsUpcoming').textContent = data.upcomingEvents || 0;
                    document.getElementById('eventStatsWithFiles').textContent = data.eventsWithFiles || 0;
                } else {
                    console.error('Failed to load event stats');
                }
            } catch (error) {
                console.error('Error loading event stats:', error);
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥çµ±è¨ˆ
        document.addEventListener('DOMContentLoaded', function() {
            // å»¶é²è¼‰å…¥çµ±è¨ˆï¼Œç¢ºä¿ç”¨æˆ¶å·²ç™»å…¥
            setTimeout(loadNewsQuickStats, 2000);
            setTimeout(loadMemberQuickStats, 2500);
            setTimeout(loadEventQuickStats, 3000);
        });
    </script>
</body>
</html>