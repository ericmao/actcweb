<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACTC - 國際資訊安全人才培育與推廣協會</title>
    <!-- 統一 Tailwind 配置 - 必須在 Tailwind CSS 之前載入 -->
    <script src="assets/js/tailwind-config.js"></script>
    <!-- 使用更稳定的 Tailwind CSS 版本 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- 添加 Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <!-- 統一樣式文件 -->
    <link rel="stylesheet" href="assets/css/common.css" />
</head>
<body class="bg-gray-50">
    <!-- 導航欄 -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10">
                        <img src="assets/images/actc-logo.jpg" alt="ACTC Logo" class="w-full h-full object-contain rounded-full" loading="lazy">
                    </div>
                    <span class="text-xl font-bold text-gray-800">ACTC</span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="#home" class="nav-link text-gray-600 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">首頁</a>
                    <a href="about.html" class="nav-link text-gray-600 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">關於協會</a>
                    <a href="#news" class="nav-link text-gray-600 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">最新消息</a>
                    <a href="#events" class="nav-link text-gray-600 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">活動課程</a>
                    <a href="#corporate-members" class="nav-link text-gray-600 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">企業會員</a>
                    <a href="workgroups.html" class="nav-link text-gray-600 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">工作小組</a>
                </div>
                <div class="md:hidden">
                    <button class="text-gray-600 hover:text-actc-orange focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 首頁區塊 -->
    <section id="home" class="bg-gradient-to-br from-actc-orange to-actc-orange-dark text-white py-20 fade-in">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="mb-8">
                <div class="w-64 h-64 mx-auto">
                    <img src="assets/images/actc-logo.jpg" alt="ACTC Logo" class="w-full h-full object-contain" loading="lazy">
                </div>
            </div>
            <h1 class="text-4xl md:text-6xl font-bold mb-6">ACTC</h1>
            <h2 class="text-xl md:text-2xl mb-8">國際資訊安全人才培育與推廣協會</h2>
            <p class="text-lg md:text-xl max-w-3xl mx-auto opacity-90">
                致力於推動資訊安全教育，培養專業人才，建立安全的數位環境
            </p>
        </div>
    </section>

    <!-- 最新消息 -->
    <section id="news" class="py-20 bg-white fade-in">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">最新消息</h2>
                <div class="w-24 h-1 bg-actc-orange mx-auto"></div>
            </div>

            <!-- 分類篩選 -->
            <div class="flex flex-wrap justify-center gap-4 mb-12">
                <button class="category-filter px-6 py-3 rounded-full border-2 border-gray-300 text-gray-600 hover:border-actc-orange hover:text-actc-orange transition-all duration-300 active" data-category="all">
                    全部消息
                </button>
                <button class="category-filter px-6 py-3 rounded-full border-2 border-gray-300 text-gray-600 hover:border-actc-orange hover:text-actc-orange transition-all duration-300" data-category="聯盟動態">
                    聯盟動態
                </button>
                <button class="category-filter px-6 py-3 rounded-full border-2 border-gray-300 text-gray-600 hover:border-actc-orange hover:text-actc-orange transition-all duration-300" data-category="活動預告">
                    活動預告
                </button>
                <button class="category-filter px-6 py-3 rounded-full border-2 border-gray-300 text-gray-600 hover:border-actc-orange hover:text-actc-orange transition-all duration-300" data-category="技術分享">
                    技術分享
                </button>
                <button class="category-filter px-6 py-3 rounded-full border-2 border-gray-300 text-gray-600 hover:border-actc-orange hover:text-actc-orange transition-all duration-300" data-category="一般">
                    一般消息
                </button>
            </div>

            <!-- 載入中狀態 -->
            <div id="news-loading" class="text-center py-12">
                <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-actc-orange transition ease-in-out duration-150">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-actc-orange" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    載入中...
                </div>
            </div>

            <!-- 新聞列表容器 -->
            <div id="news-container" class="grid grid-cols-1 md:grid-cols-2 gap-8 hidden">
                <!-- 新聞卡片將在這裡動態生成 -->
            </div>

            <!-- 無新聞時的提示 -->
            <div id="news-empty" class="text-center py-12 hidden">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">暫無最新消息</h3>
                <p class="mt-1 text-sm text-gray-500">請稍後再來查看</p>
            </div>

            <!-- 載入更多按鈕 -->
            <div id="load-more-container" class="text-center mt-12 hidden">
                <button id="load-more-btn" class="btn-primary px-8 py-3 focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                    載入更多消息
                </button>
            </div>
        </div>
    </section>

    <!-- 活動課程 -->
    <section id="events" class="py-20 bg-gray-50 fade-in">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">活動課程</h2>
                <div class="w-24 h-1 bg-actc-orange mx-auto"></div>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto mt-4">
                    專業的資安培訓課程、工作坊和研討會，助您提升資訊安全技能
                </p>
            </div>

            <!-- 搜尋和篩選區塊 -->
            <div class="mb-8 bg-white rounded-lg shadow-md p-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- 搜尋框 -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">搜尋活動課程</label>
                        <div class="relative">
                            <input type="text" id="eventsSearch" placeholder="搜尋標題、描述、講師..." 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-actc-sand focus:border-actc-sand">
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 類型篩選 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">活動類型</label>
                        <select id="eventsTypeFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-actc-sand focus:border-actc-sand">
                            <option value="">全部類型</option>
                            <option value="course">課程</option>
                            <option value="workshop">工作坊</option>
                            <option value="meetup">聚會</option>
                            <option value="conference">研討會</option>
                            <option value="training">培訓</option>
                            <option value="others">其他</option>
                        </select>
                    </div>
                    
                    <!-- 排序方式 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">排序方式</label>
                        <select id="eventsSort" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-actc-sand focus:border-actc-sand">
                            <option value="date-asc">日期 (近到遠)</option>
                            <option value="date-desc">日期 (遠到近)</option>
                            <option value="title-asc">標題 (A-Z)</option>
                            <option value="title-desc">標題 (Z-A)</option>
                        </select>
                    </div>
                </div>
                
                <!-- 標籤篩選 -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">熱門標籤</label>
                    <div id="eventsTagsFilter" class="flex flex-wrap gap-2">
                        <!-- 標籤將由 JavaScript 動態生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 載入中狀態 -->
            <div id="events-loading" class="text-center py-12">
                <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-actc-orange transition ease-in-out duration-150">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-actc-orange" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    載入活動課程中...
                </div>
            </div>

            <!-- 活動列表容器 -->
            <div id="events-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
                <!-- 活動卡片將在這裡動態生成 -->
            </div>

            <!-- 無活動時的提示 -->
            <div id="events-empty" class="text-center py-12 hidden">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">暫無活動課程</h3>
                <p class="mt-1 text-sm text-gray-500">請稍後再來查看或嘗試調整搜尋條件</p>
            </div>

            <!-- 載入更多按鈕 -->
            <div id="load-more-events-container" class="text-center mt-12 hidden">
                <button id="load-more-events-btn" class="btn-primary px-8 py-3 focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                    載入更多活動
                </button>
            </div>
        </div>
    </section>

    <!-- 企業會員專區 -->
    <section id="corporate-members" class="py-20 bg-white fade-in">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">企業會員專區</h2>
                <div class="w-24 h-1 bg-actc-orange mx-auto mb-6"></div>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto">
                    感謝企業夥伴的支持與參與，共同推動資訊安全人才培育發展
                </p>
            </div>

            <!-- 載入狀態 -->
            <div id="home-members-loading" class="flex flex-col items-center justify-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-actc-orange"></div>
                <p class="mt-4 text-gray-600">載入企業會員資料中...</p>
            </div>

            <!-- 空狀態 -->
            <div id="home-members-empty" class="hidden text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">暫無企業會員</h3>
                <p class="mt-1 text-sm text-gray-500">目前沒有企業會員資料</p>
            </div>

            <!-- 錯誤狀態 -->
            <div id="home-members-error" class="hidden text-center py-12">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">載入失敗</h3>
                <p class="mt-1 text-sm text-gray-500">無法載入企業會員資料，請稍後再試</p>
            </div>

            <!-- 企業會員容器 -->
            <div id="home-members-container" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- 動態載入的企業會員內容 -->
            </div>

            <!-- 查看更多按鈕 -->
            <div class="text-center mt-12">
                <a href="corporate-members.html" class="btn-primary inline-flex items-center px-8 py-3 font-medium focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                    查看所有企業會員
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                    </svg>
                </a>
            </div>
        </div>
    </section>

    <!-- 頁尾 -->
    <footer class="bg-gray-800 text-white py-12 fade-in">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-10 h-10">
                            <img src="assets/images/actc-logo.jpg" alt="ACTC Logo" class="w-full h-full object-contain rounded-full" loading="lazy">
                        </div>
                        <span class="text-xl font-bold">ACTC</span>
                    </div>
                    <p class="text-gray-300 mb-4">國際資訊安全人才培育與推廣協會</p>
                    <p class="text-gray-400 text-sm">致力於推動資訊安全教育，培養專業人才</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">聯絡資訊</h3>
                    <div class="space-y-2 text-gray-300">
                        <p>電話：(02) 2345-6789</p>
                        <p>傳真：(02) 2345-6790</p>
                        <p>信箱：info@actc.org.tw</p>
                        <p>地址：105台北市松山區復興北路57號</p>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">快速連結</h3>
                    <div class="space-y-2">
                        <a href="about.html" class="nav-link block text-gray-300 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">關於協會</a>
                        <a href="#news" class="nav-link block text-gray-300 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">最新消息</a>
                        <a href="#events" class="nav-link block text-gray-300 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">活動課程</a>
                        <a href="#corporate-members" class="nav-link block text-gray-300 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">企業會員</a>
                        <a href="workgroups.html" class="nav-link block text-gray-300 hover:text-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">工作小組</a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-400">&copy; 2025 ACTC - 國際資訊安全人才培育與推廣協會. 版權所有.</p>
            </div>
        </div>
    </footer>

    <!-- Swiper.js -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    
    <!-- 主要 JavaScript -->
    <script>
        // 新聞管理
        class NewsManager {
            constructor() {
                this.newsContainer = document.getElementById('news-container');
                this.newsLoading = document.getElementById('news-loading');
                this.newsEmpty = document.getElementById('news-empty');
                this.loadMoreContainer = document.getElementById('load-more-container');
                this.loadMoreBtn = document.getElementById('load-more-btn');
                this.categoryFilters = document.querySelectorAll('.category-filter');
                this.currentCategory = 'all'; // 預設顯示全部
                this.allNews = []; // 儲存所有新聞
                this.currentPage = 1; // 當前頁碼
                this.itemsPerPage = 6; // 每頁顯示數量
                this.init();
            }

            async init() {
                await this.loadNews();
                this.addEventListeners();
            }

            async loadNews() {
                try {
                    const response = await fetch('/api/news');
                    if (!response.ok) throw new Error('Failed to fetch news');
                    
                    this.allNews = await response.json();
                    this.displayNews();
                } catch (error) {
                    console.error('Error loading news:', error);
                    this.showError();
                }
            }

            displayNews() {
                this.newsLoading.classList.add('hidden');
                
                if (!this.allNews || this.allNews.length === 0) {
                    this.newsEmpty.classList.remove('hidden');
                    return;
                }

                this.newsContainer.classList.remove('hidden');
                this.filterNews();
                this.initializeSwipers();
            }

            filterNews() {
                const filteredNews = this.allNews.filter(news => {
                    const newsCategory = news.category || '一般';
                    return this.currentCategory === 'all' || newsCategory === this.currentCategory;
                });

                this.newsContainer.innerHTML = filteredNews.slice(0, this.itemsPerPage).map(item => this.createNewsCard(item)).join('');

                if (filteredNews.length > this.itemsPerPage) {
                    this.loadMoreContainer.classList.remove('hidden');
                    this.loadMoreBtn.addEventListener('click', () => this.loadMore());
                } else {
                    this.loadMoreContainer.classList.add('hidden');
                }
            }

            loadMore() {
                this.currentPage++;
                const startIndex = this.currentPage * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const filteredNews = this.allNews.filter(news => {
                    const newsCategory = news.category || '一般';
                    return this.currentCategory === 'all' || newsCategory === this.currentCategory;
                });

                const newsToAdd = filteredNews.slice(startIndex, endIndex).map(item => this.createNewsCard(item));
                this.newsContainer.innerHTML += newsToAdd.join('');
                this.initializeSwipers();

                if (endIndex >= filteredNews.length) {
                    this.loadMoreContainer.classList.add('hidden');
                    this.loadMoreBtn.removeEventListener('click', () => this.loadMore());
                }
            }

            createNewsCard(news) {
                const images = news.images && news.images.length > 0 ? news.images : [];
                const hasImages = images.length > 0;
                const hasFile = news.file;
                const hasLink = news.link;
                const newsDate = news.date ? new Date(news.date) : new Date();
                const category = news.category || '一般';
                
                return `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 cursor-pointer" 
                         onclick="showNewsModal('${news.title}', '${newsDate.toLocaleDateString('zh-TW')}', '${news.description.replace(/'/g, "\\'")}', '${news.category || '一般'}')"
                         role="button"
                         tabindex="0"
                         aria-label="點擊查看 ${news.title} 的詳細資訊"
                         onkeydown="if(event.key === 'Enter' || event.key === ' ') { event.preventDefault(); showNewsModal('${news.title}', '${newsDate.toLocaleDateString('zh-TW')}', '${news.description.replace(/'/g, "\\'")}', '${news.category || '一般'}') }">
                        ${hasImages ? `
                            <div class="swiper-container h-48 relative">
                                <div class="swiper-wrapper">
                                    ${images.map(img => `
                                        <div class="swiper-slide">
                                            <img src="${img.startsWith('/') ? img : '/' + img}" alt="${news.title}" class="w-full h-full object-cover" loading="lazy" onerror="this.style.display='none'">
                                        </div>
                                    `).join('')}
                                </div>
                                ${images.length > 1 ? `
                                    <div class="swiper-pagination"></div>
                                    <div class="swiper-button-next"></div>
                                    <div class="swiper-button-prev"></div>
                                ` : ''}
                                <!-- 分類標籤 -->
                                <div class="absolute top-3 left-3">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-actc-orange text-white shadow-lg">
                                        ${category}
                                    </span>
                                </div>
                            </div>
                        ` : `
                            <div class="h-48 bg-gradient-to-br from-actc-orange to-actc-orange-dark flex items-center justify-center relative hover:opacity-90 transition-opacity">
                                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <!-- 分類標籤 -->
                                <div class="absolute top-3 left-3">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white text-actc-orange shadow-lg">
                                        ${category}
                                    </span>
                                </div>
                            </div>
                        `}
                        
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-xl font-semibold text-gray-800 line-clamp-2">${news.title}</h3>
                                <span class="text-sm text-actc-orange font-medium whitespace-nowrap ml-2">${newsDate.toLocaleDateString('zh-TW')}</span>
                            </div>
                            
                            <p class="text-gray-600 mb-4 line-clamp-3 leading-relaxed">${news.description}</p>
                            
                            <div class="space-y-2">
                                ${hasFile ? `
                                    <a href="${news.file.startsWith('/') ? news.file : '/' + news.file}" download class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-actc-orange hover:bg-actc-orange-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-actc-sand transition-colors">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 012 2z" />
                                        </svg>
                                        下載附件
                                    </a>
                                ` : ''}
                                
                                ${hasLink ? `
                                    <a href="${news.link}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-3 py-2 border border-actc-orange text-sm leading-4 font-medium rounded-md text-actc-orange bg-white hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                        </svg>
                                        活動連結
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }

            initializeSwipers() {
                const swiperContainers = document.querySelectorAll('.swiper-container');
                swiperContainers.forEach(container => {
                    const pagination = container.querySelector('.swiper-pagination');
                    const nextButton = container.querySelector('.swiper-button-next');
                    const prevButton = container.querySelector('.swiper-button-prev');
                    
                    new Swiper(container, {
                        loop: true,
                        autoplay: {
                            delay: 5000,
                            disableOnInteraction: false,
                        },
                        pagination: pagination ? {
                            el: pagination,
                            clickable: true,
                        } : false,
                        navigation: (nextButton && prevButton) ? {
                            nextEl: nextButton,
                            prevEl: prevButton,
                        } : false,
                        effect: 'slide',
                        speed: 400,
                    });
                });
            }

            showError() {
                this.newsLoading.classList.add('hidden');
                this.newsEmpty.classList.remove('hidden');
                this.newsEmpty.innerHTML = `
                    <svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">載入失敗</h3>
                    <p class="mt-1 text-sm text-gray-500">無法載入最新消息，請稍後再試</p>
                `;
            }

            addEventListeners() {
                this.categoryFilters.forEach(filter => {
                    filter.addEventListener('click', () => {
                        // 更新按鈕狀態 - 改進版型樣式
                        this.categoryFilters.forEach(f => {
                            f.classList.remove('active', 'bg-actc-orange', 'text-white', 'border-actc-orange');
                            f.classList.add('border-gray-300', 'text-gray-600');
                        });
                        
                        filter.classList.add('active', 'bg-actc-orange', 'text-white', 'border-actc-orange');
                        filter.classList.remove('border-gray-300', 'text-gray-600');
                        
                        // 更新當前分類
                        this.currentCategory = filter.dataset.category;
                        this.currentPage = 1; // 切換分類時重置頁碼
                        this.filterNews();
                        this.loadMoreContainer.classList.add('hidden'); // 切換分類時隱藏載入更多
                        
                        // 移除舊的載入更多監聽器
                        this.loadMoreBtn.removeEventListener('click', this.loadMore);
                        
                        // 添加新的載入更多監聽器
                        this.loadMoreBtn.addEventListener('click', () => this.loadMore());
                    });
                });
            }
        }

        // 首頁企業會員管理器
        class HomeMembersManager {
            constructor() {
                this.membersContainer = document.getElementById('home-members-container');
                this.loadingElement = document.getElementById('home-members-loading');
                this.emptyElement = document.getElementById('home-members-empty');
                this.errorElement = document.getElementById('home-members-error');
                this.apiUrl = '/api/corporate-members/displayed';
                
                this.loadMembers();
            }
            
            async loadMembers() {
                try {
                    this.showLoading();
                    const response = await fetch(this.apiUrl);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.message || 'API request failed');
                    }
                    
                    const members = data.members || [];
                    
                    if (members.length === 0) {
                        this.showEmpty();
                    } else {
                        // 只顯示前 6 個企業會員
                        const displayMembers = members.slice(0, 6);
                        this.renderMembers(displayMembers);
                        this.showMembers();
                    }
                } catch (error) {
                    console.error('載入企業會員失敗:', error);
                    this.showError();
                }
            }
            
            renderMembers(members) {
                this.membersContainer.innerHTML = '';
                
                members.forEach((member, index) => {
                    const memberCard = this.createMemberCard(member);
                    this.membersContainer.appendChild(memberCard);
                });
                
                // 添加淡入動畫
                setTimeout(() => {
                    const cards = this.membersContainer.querySelectorAll('.member-card');
                    cards.forEach((card, index) => {
                        setTimeout(() => {
                            card.style.opacity = '1';
                            card.classList.add('fade-in-up');
                        }, index * 100);
                    });
                }, 100);
            }
            
            createMemberCard(member) {
                const card = document.createElement('div');
                card.className = 'member-card bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 opacity-0';
                
                const logoDisplay = member.logo ? 
                    `<div class="w-full h-32 mb-4 flex items-center justify-center bg-gray-50 rounded-lg p-4">
                        <img src="${member.logo.startsWith('http') ? member.logo : member.logo}" alt="${member.companyName} Logo" class="max-w-full max-h-full object-contain" loading="lazy" onerror="this.parentElement.innerHTML='<svg class=&quot;w-12 h-12 text-gray-400&quot; fill=&quot;none&quot; stroke=&quot;currentColor&quot; viewBox=&quot;0 0 24 24&quot;><path stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; d=&quot;M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4&quot;></path></svg>';">
                     </div>` :
                    `<div class="w-full h-32 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg mb-4 flex items-center justify-center">
                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                    </div>`;

                const websiteLink = member.website ? 
                    `<div class="pt-3 border-t border-gray-100 mt-auto">
                        <a href="${member.website}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center text-actc-orange hover:text-actc-orange-dark transition-colors font-medium text-sm focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2 rounded">
                            <span>訪問網站</span>
                            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                            </svg>
                        </a>
                    </div>` : '';

                card.innerHTML = `
                    <div class="p-6 h-full flex flex-col">
                        ${logoDisplay}
                        <div class="flex-grow">
                            <h3 class="text-lg font-bold text-gray-800 mb-2">${member.companyName || '未命名企業'}</h3>
                            <p class="text-gray-600 text-sm leading-relaxed">${member.description ? (member.description.length > 100 ? member.description.substring(0, 100) + '...' : member.description) : '暫無描述'}</p>
                        </div>
                        ${websiteLink}
                    </div>
                `;
                
                return card;
            }
            
            showLoading() {
                this.loadingElement.classList.remove('hidden');
                this.emptyElement.classList.add('hidden');
                this.errorElement.classList.add('hidden');
                this.membersContainer.classList.add('hidden');
            }
            
            showEmpty() {
                this.loadingElement.classList.add('hidden');
                this.emptyElement.classList.remove('hidden');
                this.errorElement.classList.add('hidden');
                this.membersContainer.classList.add('hidden');
            }
            
            showError() {
                this.loadingElement.classList.add('hidden');
                this.emptyElement.classList.add('hidden');
                this.errorElement.classList.remove('hidden');
                this.membersContainer.classList.add('hidden');
            }
            
            showMembers() {
                this.loadingElement.classList.add('hidden');
                this.emptyElement.classList.add('hidden');
                this.errorElement.classList.add('hidden');
                this.membersContainer.classList.remove('hidden');
            }
        }

        // 首頁活動課程管理器
        class HomeEventsManager {
            constructor() {
                this.eventsContainer = document.getElementById('events-container');
                this.loadingElement = document.getElementById('events-loading');
                this.emptyElement = document.getElementById('events-empty');
                this.loadMoreContainer = document.getElementById('load-more-events-container');
                this.loadMoreBtn = document.getElementById('load-more-events-btn');
                this.searchInput = document.getElementById('eventsSearch');
                this.typeFilter = document.getElementById('eventsTypeFilter');
                this.sortSelect = document.getElementById('eventsSort');
                this.tagsFilter = document.getElementById('eventsTagsFilter');
                
                this.apiUrl = '/api/events';
                this.currentPage = 1;
                this.itemsPerPage = 6;
                this.allEvents = [];
                this.filteredEvents = [];
                this.currentFilters = {
                    search: '',
                    type: '',
                    tags: [],
                    sortBy: 'date',
                    sortOrder: 'asc'
                };
                
                this.loadEvents();
                this.addEventListeners();
                this.setupSearchDebounce();
            }
            
            async loadEvents() {
                try {
                    this.showLoading();
                    
                    // 構建查詢參數
                    const params = new URLSearchParams({
                        page: this.currentPage,
                        limit: this.itemsPerPage,
                        sortBy: this.currentFilters.sortBy,
                        sortOrder: this.currentFilters.sortOrder
                    });
                    
                    if (this.currentFilters.type) {
                        params.append('type', this.currentFilters.type);
                    }
                    
                    if (this.currentFilters.search) {
                        params.append('search', this.currentFilters.search);
                    }
                    
                    if (this.currentFilters.tags.length > 0) {
                        params.append('tags', this.currentFilters.tags.join(','));
                    }
                    
                    const response = await fetch(`${this.apiUrl}?${params}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    this.allEvents = data.events;
                    this.filteredEvents = [...this.allEvents];
                    
                    // 更新標籤篩選器
                    this.updateTagsFilter();
                    
                    if (this.allEvents.length === 0) {
                        this.showEmpty();
                    } else {
                        this.displayEvents();
                    }
                } catch (error) {
                    console.error('載入活動課程失敗:', error);
                    this.showError();
                }
            }
            
            updateTagsFilter() {
                // 收集所有活動的標籤
                const allTags = new Set();
                this.allEvents.forEach(event => {
                    if (event.tags && Array.isArray(event.tags)) {
                        event.tags.forEach(tag => allTags.add(tag));
                    }
                });
                
                // 生成標籤按鈕
                this.tagsFilter.innerHTML = '';
                allTags.forEach(tag => {
                    const tagButton = document.createElement('button');
                    tagButton.className = 'px-3 py-1 text-sm border border-gray-300 rounded-full hover:bg-actc-orange hover:text-white hover:border-actc-orange transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2';
                    tagButton.textContent = tag;
                    tagButton.dataset.tag = tag;
                    
                    // 檢查是否已選中
                    if (this.currentFilters.tags.includes(tag)) {
                        tagButton.classList.add('bg-actc-orange', 'text-white', 'border-actc-orange');
                    }
                    
                    tagButton.addEventListener('click', () => this.toggleTag(tag));
                    this.tagsFilter.appendChild(tagButton);
                });
            }
            
            toggleTag(tag) {
                const tagIndex = this.currentFilters.tags.indexOf(tag);
                if (tagIndex > -1) {
                    this.currentFilters.tags.splice(tagIndex, 1);
                } else {
                    this.currentFilters.tags.push(tag);
                }
                
                this.currentPage = 1;
                this.loadEvents();
            }
            
            displayEvents() {
                this.loadingElement.classList.add('hidden');
                
                if (!this.filteredEvents || this.filteredEvents.length === 0) {
                    this.emptyElement.classList.remove('hidden');
                    this.eventsContainer.classList.add('hidden');
                    this.loadMoreContainer.classList.add('hidden');
                    return;
                }

                this.eventsContainer.classList.remove('hidden');
                this.emptyElement.classList.add('hidden');
                this.renderEvents();
                
                // 檢查是否需要顯示載入更多按鈕
                if (this.filteredEvents.length > this.itemsPerPage) {
                    this.loadMoreContainer.classList.remove('hidden');
                } else {
                    this.loadMoreContainer.classList.add('hidden');
                }
            }
            
            renderEvents() {
                const eventsToShow = this.filteredEvents.slice(0, this.itemsPerPage);
                this.eventsContainer.innerHTML = eventsToShow.map(event => this.createEventCard(event)).join('');
            }
            
            loadMore() {
                this.currentPage++;
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                
                const eventsToAdd = this.filteredEvents.slice(startIndex, endIndex).map(event => this.createEventCard(event));
                this.eventsContainer.innerHTML += eventsToAdd.join('');

                if (endIndex >= this.filteredEvents.length) {
                    this.loadMoreContainer.classList.add('hidden');
                }
            }
            
            createEventCard(event) {
                const eventDate = new Date(event.date);
                const typeColors = {
                    'meetup': 'bg-blue-100 text-blue-800',
                    'workshop': 'bg-green-100 text-green-800',
                    'course': 'bg-purple-100 text-purple-800',
                    'conference': 'bg-indigo-100 text-indigo-800',
                    'training': 'bg-pink-100 text-pink-800',
                    'others': 'bg-gray-100 text-gray-800'
                };
                
                const typeColor = typeColors[event.type] || typeColors['others'];
                const typeLabel = event.typeLabel || event.type;
                
                // 檢查活動狀態
                const statusInfo = this.getStatusInfo(event);
                
                return `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                        <div class="h-48 bg-gradient-to-br from-actc-orange to-actc-orange-dark flex items-center justify-center relative">
                            ${event.image ? `
                                <img src="${event.image}" alt="${event.title}" class="w-full h-full object-cover">
                            ` : `
                                <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                                </svg>
                            `}
                            
                            <!-- 類型標籤 -->
                            <div class="absolute top-3 left-3">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${typeColor} shadow-lg">
                                    ${typeLabel}
                                </span>
                            </div>
                            
                            <!-- 狀態標籤 -->
                            ${statusInfo.badge ? `
                                <div class="absolute top-3 right-3">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${statusInfo.badgeClass} shadow-lg">
                                        ${statusInfo.badge}
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-3 line-clamp-2">${event.title}</h3>
                            
                            ${event.shortDescription ? `
                                <p class="text-gray-600 mb-4 line-clamp-2 leading-relaxed">${event.shortDescription}</p>
                            ` : `
                                <p class="text-gray-600 mb-4 line-clamp-3 leading-relaxed">${event.description}</p>
                            `}
                            
                            <!-- 講師資訊 -->
                            ${event.instructor && event.instructor.name ? `
                                <div class="flex items-center text-sm text-gray-500 mb-3">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    <span>${event.instructor.name}${event.instructor.title ? ` - ${event.instructor.title}` : ''}</span>
                                </div>
                            ` : ''}
                            
                            <!-- 時長資訊 -->
                            ${event.formattedDuration ? `
                                <div class="flex items-center text-sm text-gray-500 mb-3">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span>${event.formattedDuration}</span>
                                </div>
                            ` : ''}
                            
                            <div class="space-y-2">
                                <div class="flex items-center text-sm text-gray-500">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span>${eventDate.toLocaleDateString('zh-TW', {
                                        year: 'numeric',
                                        month: '2-digit',
                                        day: '2-digit',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}</span>
                                </div>
                                
                                <div class="flex items-center text-sm text-gray-500">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    <span class="truncate">${event.location}</span>
                                </div>
                                
                                <!-- 價格資訊 -->
                                ${event.formattedPrice ? `
                                    <div class="flex items-center text-sm text-gray-500">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                        </svg>
                                        <span class="font-medium ${event.price.isFree ? 'text-green-600' : 'text-orange-600'}">${event.formattedPrice}</span>
                                    </div>
                                ` : ''}
                                
                                <!-- 名額資訊 -->
                                ${event.capacity ? `
                                    <div class="flex items-center text-sm text-gray-500">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                        </svg>
                                        <span>${event.registeredCount || 0}/${event.capacity} 人</span>
                                    </div>
                                ` : ''}
                                
                                <!-- 標籤 -->
                                ${event.tags && event.tags.length > 0 ? `
                                    <div class="flex flex-wrap gap-1 mt-3">
                                        ${event.tags.slice(0, 3).map(tag => `
                                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                ${tag}
                                            </span>
                                        `).join('')}
                                        ${event.tags.length > 3 ? `
                                            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                                +${event.tags.length - 3}
                                            </span>
                                        ` : ''}
                                    </div>
                                ` : ''}
                                
                                <!-- 操作按鈕 -->
                                <div class="flex gap-2 mt-4">
                                    ${event.canRegister ? `
                                        <button onclick="registerForEvent('${event._id}')" class="flex-1 bg-actc-orange hover:bg-actc-orange-dark text-white px-4 py-2 rounded-md transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                                            立即報名
                                        </button>
                                    ` : ''}
                                    
                                    ${event.hasFile ? `
                                        <a href="/api/events/${event._id}/download" class="flex-1 border border-blue-500 text-blue-500 bg-white hover:bg-blue-50 px-4 py-2 rounded-md transition-colors text-sm font-medium text-center focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                                            <i class="fas fa-download mr-2"></i>下載檔案
                                        </a>
                                    ` : ''}
                                    
                                    ${event.link ? `
                                        <a href="${event.link}" target="_blank" rel="noopener noreferrer" class="flex-1 border border-actc-orange text-actc-orange bg-white hover:bg-gray-50 px-4 py-2 rounded-md transition-colors text-sm font-medium text-center focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                                            ${event.link.includes('discord') ? 'Discord' : 
                                              event.link.includes('teams') ? 'Teams' : 
                                              event.link.includes('zoom') ? 'Zoom' : 
                                              event.link.includes('meet.google') ? 'Google Meet' : '活動連結'}
                                        </a>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            getStatusInfo(event) {
                const status = event.status || 'published';
                const now = new Date();
                const eventDate = new Date(event.date);
                
                if (status === 'cancelled') {
                    return {
                        badge: '已取消',
                        badgeClass: 'bg-red-100 text-red-800'
                    };
                }
                
                if (status === 'completed') {
                    return {
                        badge: '已完成',
                        badgeClass: 'bg-gray-100 text-gray-800'
                    };
                }
                
                if (eventDate < now) {
                    return {
                        badge: '已結束',
                        badgeClass: 'bg-gray-100 text-gray-800'
                    };
                }
                
                if (status === 'registration_open') {
                    if (event.capacity && event.registeredCount >= event.capacity) {
                        return {
                            badge: '名額已滿',
                            badgeClass: 'bg-red-100 text-red-800'
                        };
                    }
                    return {
                        badge: '報名開放',
                        badgeClass: 'bg-green-100 text-green-800'
                    };
                }
                
                if (status === 'registration_closed') {
                    return {
                        badge: '報名截止',
                        badgeClass: 'bg-yellow-100 text-yellow-800'
                    };
                }
                
                return {};
            }
            
            showLoading() {
                this.loadingElement.classList.remove('hidden');
                this.emptyElement.classList.add('hidden');
                this.eventsContainer.classList.add('hidden');
                this.loadMoreContainer.classList.add('hidden');
            }
            
            showEmpty() {
                this.loadingElement.classList.add('hidden');
                this.emptyElement.classList.remove('hidden');
                this.eventsContainer.classList.add('hidden');
                this.loadMoreContainer.classList.add('hidden');
            }
            
            showError() {
                this.loadingElement.classList.add('hidden');
                this.emptyElement.classList.remove('hidden');
                this.emptyElement.innerHTML = `
                    <svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">載入失敗</h3>
                    <p class="mt-1 text-sm text-gray-500">無法載入活動課程，請稍後再試</p>
                `;
                this.eventsContainer.classList.add('hidden');
                this.loadMoreContainer.classList.add('hidden');
            }
            
            setupSearchDebounce() {
                let searchTimeout;
                this.searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.currentFilters.search = e.target.value.trim();
                        this.currentPage = 1;
                        this.loadEvents();
                    }, 500);
                });
            }
            
            addEventListeners() {
                // 類型篩選
                this.typeFilter.addEventListener('change', (e) => {
                    this.currentFilters.type = e.target.value;
                    this.currentPage = 1;
                    this.loadEvents();
                });
                
                // 排序
                this.sortSelect.addEventListener('change', (e) => {
                    const [sortBy, sortOrder] = e.target.value.split('-');
                    this.currentFilters.sortBy = sortBy;
                    this.currentFilters.sortOrder = sortOrder;
                    this.currentPage = 1;
                    this.loadEvents();
                });
                
                // 載入更多
                this.loadMoreBtn.addEventListener('click', () => this.loadMore());
            }
        }

        // 平滑滾動
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // 導航欄高亮當前區塊
        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('nav a[href^="#"]');
            
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (scrollY >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('text-actc-orange');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('text-actc-orange');
                }
            });
        });

        // 初始化管理器
        document.addEventListener('DOMContentLoaded', () => {
            new NewsManager();
            new HomeMembersManager();
            new HomeEventsManager();
        });

        // 活動報名功能
        async function registerForEvent(eventId) {
            try {
                // 顯示報名表單
                showRegistrationForm(eventId);
            } catch (error) {
                console.error('報名失敗:', error);
                showNotification('報名失敗，請稍後再試', 'error');
            }
        }
        
        // 顯示報名表單
        function showRegistrationForm(eventId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50';
            modal.id = 'registrationModal';
            
            modal.innerHTML = `
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                    <div class="mt-3 text-center">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">活動報名</h3>
                        <form id="registrationForm" class="text-left">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">姓名 *</label>
                                <input type="text" id="participantName" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-actc-sand focus:border-actc-sand"
                                       placeholder="請輸入您的姓名">
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">電子郵件 *</label>
                                <input type="email" id="participantEmail" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-actc-sand focus:border-actc-sand"
                                       placeholder="請輸入您的電子郵件">
                            </div>
                            <div class="flex gap-3">
                                <button type="submit" class="flex-1 bg-actc-orange hover:bg-actc-orange-dark text-white px-4 py-2 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                                    確認報名
                                </button>
                                <button type="button" onclick="closeRegistrationModal()" class="flex-1 border border-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-50 transition-colors focus:outline-none focus:ring-2 focus:ring-actc-sand focus:ring-offset-2">
                                    取消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 處理表單提交
            document.getElementById('registrationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await submitRegistration(eventId);
            });
        }
        
        // 提交報名
        async function submitRegistration(eventId) {
            const name = document.getElementById('participantName').value.trim();
            const email = document.getElementById('participantEmail').value.trim();
            
            if (!name || !email) {
                showNotification('請填寫所有必填欄位', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/events/${eventId}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        participantName: name,
                        participantEmail: email
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || '報名失敗');
                }
                
                const result = await response.json();
                closeRegistrationModal();
                showNotification('報名成功！', 'success');
                
                // 重新載入活動資料
                if (window.homeEventsManager) {
                    window.homeEventsManager.loadEvents();
                }
                
            } catch (error) {
                console.error('報名失敗:', error);
                showNotification(error.message || '報名失敗，請稍後再試', 'error');
            }
        }
        
        // 關閉報名表單
        function closeRegistrationModal() {
            const modal = document.getElementById('registrationModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 顯示新聞模態框
        function showNewsModal(title, date, description, category) {
            // 移除現有的模態框
            const existingModal = document.querySelector('.news-modal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'news-modal';
            modal.setAttribute('role', 'dialog');
            modal.setAttribute('aria-modal', 'true');
            modal.setAttribute('aria-labelledby', 'news-modal-title');
            modal.setAttribute('aria-describedby', 'news-modal-description');
            modal.innerHTML = `
                <div class="news-modal-content">
                    <button class="news-modal-close" onclick="closeNewsModal()" aria-label="關閉模態框" tabindex="0">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    <div class="mb-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-actc-orange text-white">
                            ${category}
                        </span>
                    </div>
                    <h2 id="news-modal-title" class="text-2xl font-bold text-gray-800 mb-3">${title}</h2>
                    <div class="flex items-center text-sm text-gray-600 mb-4">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>${date}</span>
                    </div>
                    <div id="news-modal-description" class="text-gray-700 leading-relaxed">
                        ${description}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 顯示動畫
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            // 點擊背景關閉
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeNewsModal();
                }
            });
            
            // 鍵盤導航支援
            const closeButton = modal.querySelector('.news-modal-close');
            const firstFocusableElement = closeButton;
            const lastFocusableElement = closeButton;
            
            // ESC鍵關閉
            const handleKeydown = (e) => {
                if (e.key === 'Escape') {
                    closeNewsModal();
                }
                
                // Tab鍵循環焦點
                if (e.key === 'Tab') {
                    if (e.shiftKey) {
                        if (document.activeElement === firstFocusableElement) {
                            e.preventDefault();
                            lastFocusableElement.focus();
                        }
                    } else {
                        if (document.activeElement === lastFocusableElement) {
                            e.preventDefault();
                            firstFocusableElement.focus();
                        }
                    }
                }
            };
            
            document.addEventListener('keydown', handleKeydown);
            
            // 聚焦到關閉按鈕
            setTimeout(() => {
                closeButton.focus();
            }, 100);
            
            // 清理事件監聽器
            modal.addEventListener('close', () => {
                document.removeEventListener('keydown', handleKeydown);
            });
        }
        
        // 關閉新聞模態框
        function closeNewsModal() {
            const modal = document.querySelector('.news-modal');
            if (modal) {
                modal.classList.remove('show');
                // 觸發關閉事件以清理事件監聽器
                modal.dispatchEvent(new Event('close'));
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }
        
        // 顯示通知
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-md shadow-lg transition-all duration-300 transform translate-x-full`;
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            notification.className += ` ${bgColor} text-white`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 動畫進入
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // 自動移除
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
